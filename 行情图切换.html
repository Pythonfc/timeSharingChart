<!DOCTYPE html>
<html lang="en">

<head>
  <!--仅包含行情图相关类型-->
  <script src="http://s.thsi.cn/js/datav/charts/0.4.23/d3_charts.hq.js"></script>
</head>

<body id="body" style="background-color: #e3e8e9;">
  <style>
    #quotation {
      position: absolute;
      width: 975px;
      height: 700px;
      left: 50%;
      top: 50%;
      background-color: #fff;
      transform: translate(-50%, -50%);
    }
  </style>
  <div id="quotation">
    <div style="position: relative; overflow: hidden; width: 600px; height: 350px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;">
      <canvas data-zr-dom-id="zr_0" width="600" height="350"
        style="position: absolute; left: 0px; top: 0px; width: 600px; height: 350px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas>
    </div>
    <h4 style="position: absolute; left: 100px; top: 100px; width: 100px; height: 100px;" >同花顺</h4>
    <div class="d3charts-tooltip" style="font-family: Microsoft Yahei; position: absolute; z-index: 99999; border-radius: 0px; padding: 2px; color: rgb(85, 85, 85); font-size: 12px; display: block; border-color: rgb(51, 51, 51); border-style: solid; border-width: 0px; left: 120px; top: 11px;">
      13:35
      <br>
      同花顺300033: 1.04
      <br>
      <span style="display: inline-block; margin-right: 5px; border-radius: 10px; width: 9px; height: 9px; background-color: green;"></span>
      同花顺300033: 3.88
    </div>
  </div>
  <script src="./js/data.js"></script>
  <script>
    var TopFont = document.getElementsByClassName('d3charts-tooltip')
    TopFont.innerHTML="<h3>同花顺300033</h3>"
    var option;
    let rowData = {
      stockCode: '300033',
      stockName: '同花顺300033'
    }
    let store = {
      getters: {
        getChartColor: {
          abAxis: 'red',
          // 右边百分比
          eqAxis: 'green',   
          beAxis: '#30C788',
          lineItem: ['#F92B3A', '#30C788', '#0094FA', '#33CCFF'],
          // 边框默认为灰色
          splitLine: '#ddd',    
          defaultFont: 'red'
        }
      }
    }
    let prePrice = 3.84
    var arr = chartData.length ? chartData : []
    let code = rowData.stockCode || rowData.rankCode
    let isNotKechuang = parseInt(code / 1000) == 688 ? false : true
    let xData = ["09:30", "09:31", "09:32", "09:33", "09:34", "09:35", "09:36", "09:37", "09:38", "09:39", "09:40", "09:41", "09:42", "09:43", "09:44", "09:45", "09:46", "09:47", "09:48", "09:49", "09:50", "09:51", "09:52", "09:53", "09:54", "09:55", "09:56", "09:57", "09:58", "09:59", "10:00", "10:01", "10:02", "10:03", "10:04", "10:05", "10:06", "10:07", "10:08", "10:09", "10:10", "10:11", "10:12", "10:13", "10:14", "10:15", "10:16", "10:17", "10:18", "10:19", "10:20", "10:21", "10:22", "10:23", "10:24", "10:25", "10:26", "10:27", "10:28", "10:29", "10:30", "10:31", "10:32", "10:33", "10:34", "10:35", "10:36", "10:37", "10:38", "10:39", "10:40", "10:41", "10:42", "10:43", "10:44", "10:45", "10:46", "10:47", "10:48", "10:49", "10:50", "10:51", "10:52", "10:53", "10:54", "10:55", "10:56", "10:57", "10:58", "10:59", "11:00", "11:01", "11:02", "11:03", "11:04", "11:05", "11:06", "11:07", "11:08", "11:09", "11:10", "11:11", "11:12", "11:13", "11:14", "11:15", "11:16", "11:17", "11:18", "11:19", "11:20", "11:21", "11:22", "11:23", "11:24", "11:25", "11:26", "11:27", "11:28", "11:29", "11:30/13:00", "13:01", "13:02", "13:03", "13:04", "13:05", "13:06", "13:07", "13:08", "13:09", "13:10", "13:11", "13:12", "13:13", "13:14", "13:15", "13:16", "13:17", "13:18", "13:19", "13:20", "13:21", "13:22", "13:23", "13:24", "13:25", "13:26", "13:27", "13:28", "13:29", "13:30", "13:31", "13:32", "13:33", "13:34", "13:35", "13:36", "13:37", "13:38", "13:39", "13:40", "13:41", "13:42", "13:43", "13:44", "13:45", "13:46", "13:47", "13:48", "13:49", "13:50", "13:51", "13:52", "13:53", "13:54", "13:55", "13:56", "13:57", "13:58", "13:59", "14:00", "14:01", "14:02", "14:03", "14:04", "14:05", "14:06", "14:07", "14:08", "14:09", "14:10", "14:11", "14:12", "14:13", "14:14", "14:15", "14:16", "14:17", "14:18", "14:19", "14:20", "14:21", "14:22", "14:23", "14:24", "14:25", "14:26", "14:27", "14:28", "14:29", "14:30", "14:31", "14:32", "14:33", "14:34", "14:35", "14:36", "14:37", "14:38", "14:39", "14:40", "14:41", "14:42", "14:43", "14:44", "14:45", "14:46", "14:47", "14:48", "14:49", "14:50", "14:51", "14:52", "14:53", "14:54", "14:55", "14:56", "14:57", "14:58", "14:59", "15:00", "15:01", "15:02", "15:03", "15:04", "15:05", "15:06", "15:07", "15:08", "15:09", "15:10", "15:11", "15:12", "15:13", "15:14", "15:15", "15:16", "15:17", "15:18", "15:19", "15:20", "15:21", "15:22", "15:23", "15:24", "15:25", "15:26", "15:27", "15:28", "15:29", "15:30"];
    var xTick = ['09:30', '10:30', '11:30/13:00', '14:00', '15:00', '15:30']
    xData = xData.splice(0, 241)
    option = {
      animation: false,
      preventDefaultMouseWheel: false,
      zranderStyle: {
        fontFamily: 'Microsoft Yahei'
      },
      data: [{
        originData: arr,
      },
      {
        $dataIndex: 0,
        originData: xData
      }
      ],
      grid: [{
        top: '20%',
        left: '10%',
        right: '10%',
        bottom: '20%',
        background: {
          show: true,
          borderEnable: [1, 1, 1, 1],
          style: {
            stroke: store.getters.getChartColor.splitLine
          }
        }
      }],
      series: [{
        type: 'line',
        dataKey: 'zhangdiefu',
        $dataIndex: 0,
        name: rowData.stockName,
        $axisIndex: [0, 2],
        line: {
          show: false
        }
      },
      {
        type: 'line',
        $dataIndex: 0,
        dataKey: 'money',
        name: rowData.stockName,
        $axisIndex: [0, 1],
        // 手动触摸圆点
        symbol: {
          emphasis: {
            show: true,
            size: 10,
            style: {
              fill: '#FF0000',                    
              stroke: store.getters.getChartColor.lineItem[3]
            }
          }
        },
        line: {
          show: true,
          normal: {
            style: {
              lineWidth: 1.5,
              stroke: store.getters.getChartColor.lineItem[3]
            }
          }
        },
        // 分时图底下的阴影部分
        area: {
                "show": true,
                "style": {
                    "normal": {
                        "fill": "rgba(46, 150, 255, 0.4)",
                        "opacity": 0.2
                    }
                }
            },
        // 手动触摸 y值竖线
        link: {
          emphasis: {
            show: true,
            style: {
              stroke: '#FF0000'                
            }
          }
        }
      }
      ],

      // top 同花顺
      tooltip: [{
        trigger: 'axis',
        $axisIndex: 0,
        position: [370, 15],
        alwaysShowContent: true,
        style: {
          fontFamily: 'Microsoft Yahei',
          position: 'absolute',
          zIndex: 99999,
          backgroundColor: undefined,
          borderRadius: '0px',
          padding: '2px',
          color: 'green',                            
          fontSize: '25px',
          display: 'none'
        }
      }],
      dataZoom: [{}],
      axis: [{
        position: 'bottom',
        type: 'band',
        $dataIndex: 1,
        $gridIndex: [0],
        line: {
          show: false,
          style: {
            color: '#2e2e2e'
          }
        },
        splitLine: {
          show: false,
          style: {
            color: '#2e2e2e'
          }
        },
        tick: {
          show: false
        },
        tickValues: xTick,
        // buttom 时间颜色
        label: {
          show: true,
          style: {
            fill: '#aaa'                                 
          }
        }
      },
      {
        position: 'left',
        type: 'linear',
        xOrY: 'y',
        $dataIndex: 1,
        dataKey: 'money',
        line: {
          show: false
        },
        tick: {
          show: false
        },
        domainScale: 1,
        addValues: [prePrice],
        tickValues: function (domain) {
          if (domain[0] == domain[1]) {
            return [domain[0] - 1, domain[0]]
          }
          // 中间值
          window.midData = ((domain[1] - domain[0]) * 5) / 10
          return [domain[0], ((domain[1] - domain[0]) * 5) / 10 + domain[0], domain[1]]
        },
        splitLine: {
          show: true,
          style: {
            lineDash: [4, 5],
            color: store.getters.getChartColor.splitLine
          }
        },
        axisName: {
          show: true,
          text: rowData.stockName,
          style: {
            fontFamily: 'Microsoft Yahei',
            color: store.getters.getChartColor.defaultFont
          },
          offset: [23, -15]
        },
        label: {
          style: function (v) {
            return {
              fill: store.getters.getChartColor.defaultFont
            }
          },
          formatter: function (v, count, allNum) {
            if (v == 0) {
              return v
            }
            return Number(v).toFixed(2)
          }
        }
      },
      {
        position: 'right',
        type: 'linear',
        xOrY: 'y',
        $dataIndex: 1,
        dataKey: 'zhangdiefu',
        line: {
          show: false
        },
        tick: {
          show: false
        },
        domainScale: 1,
        addValues: [0],
        tickValues: function (domain) {
          if (domain[0] == domain[1]) {
            return [domain[0] - 1, domain[0]]
          }
          return [domain[0], ((domain[1] - domain[0]) * 5) / 10 + domain[0], domain[1]]
        },
        splitLine: {
          show: false
        },
        axisName: {
          show: false
        },
        label: {
          style: function (v) {
            let fill
            if (v > 0) {
              fill = store.getters.getChartColor.abAxis
            } else if (v == 0) {
              fill = store.getters.getChartColor.eqAxis
            } else {
              fill = store.getters.getChartColor.beAxis
            }
            return {
              fill: fill,
              fontFamily: 'Microsoft Yahei'
            }
          },
          formatter: function (v, count, allNum) {
            if (v == 0) {
              return '0.00%'
            }
            return Number(v).toFixed(2) + '%'
          }
        }
      }
      ],
      axisPointer: [{
        $axisIndex: 1,
        line: {
          show: false,
          style: {
            stroke: '#ddd'
          }
        },
        // 手机触碰左边数据
        label: {
          show: true,
          gap: 0,
          style: {
            fill: 'white',
            textBorderRadius: 0,
            textBackgroundColor: 'green'                            
          }
        }
      },
      {
        $axisIndex: 2,
        line: {
          show: true,
          style: {
            stroke: '#ddd'                                          
          }
        },
        // 手触碰右边数据
        label: {
          show: true,
          gap: 0,
          style: {
            fill: 'white',
            textBorderRadius: 0,
            textBackgroundColor: 'red'
          }
        }
      },
      {
        $axisIndex: 0,
        line: {
          show: true,
          style: {
            stroke: '#ddd'
          }
        },
        // 手触碰底下数据
        label: {
          show: true,
          gap: 0,
          style: {
            fill: 'white',
            textBorderRadius: 0,
            textBackgroundColor: '#4B4B4B'                       
          }
        }
      }
      ],
      legend: [{
        show: false
      }],
      textStyle: {
        fill: 'blue'
      }
    }
    var myChart = D3Charts.init("quotation");
    myChart.setOption(option);
  </script>
</body>

</html>